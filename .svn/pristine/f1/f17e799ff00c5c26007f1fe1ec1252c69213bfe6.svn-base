<?php

/**
 * This is the model class for table "app_code".
 *
 * The followings are the available columns in table 'app_code':
 * @property string $app_id
 * @property string $package_id
 * @property string $app_name
 * @property integer $country_id
 * @property string $category_id
 * @property integer $app_specify_flag
 * @property string $artist_url
 * @property string $artist_name
 * @property string $price
 * @property string $current_version
 * @property string $version_update_date
 * @property string $require_android
 * @property string $size
 * @property string $insert_date
 * @property string $update_date
 * @property string $delete_date
 * @property integer $delete_flag
 * @property integer $display_flag
 * @property string $summary
 * @property string $app_icon
 * @property float $rating rating mean
 * @property int $rating_count rating count
 * @property string $screenshot1
 * @property string $screenshot2
 * @property string $screenshot3
 * @property string $screenshot4
 * @property string $screenshot5
 * @property string $screenshot6
 * @property string $screenshot7
 * @property string $screenshot8
 * @property array $keywordCodes relate keywordCodes
 * @property CountryCode $countryCode countryCode
 * @property CategoryCode $categoryCode cateogry code
 * @property array $appKeywords Description
 * @property array $keywordApps Description
 * 
 * 
 */
class AppCode extends CActiveRecord {

    /**
     * Returns the static model of the specified AR class.
     * @param string $className active record class name.
     * @return AppCode the static model class
     */
    public static function model($className = __CLASS__) {
        return parent::model($className);
    }

    /**
     * @return string the associated database table name
     */
    public function tableName() {
        return 'app_code';
    }

    /**
     * @return array validation rules for model attributes.
     */
    public function rules() {
        // NOTE: you should only define rules for those attributes that
        // will receive user inputs.
        return array(
            array('package_id,', 'required'),
            array('country_id, app_specify_flag, delete_flag, display_flag', 'numerical', 'integerOnly' => true),
            array('package_id, app_name, artist_name', 'length', 'max' => 255),
            array('category_id, price', 'length', 'max' => 10),
            array('current_version, require_android, size', 'length', 'max' => 45),
            array('app_icon, screenshot1, screenshot2, screenshot3, screenshot4, screenshot5, screenshot6, screenshot7, screenshot8', 'length', 'max' => 1000),
            array('artist_url, version_update_date, insert_date, update_date, delete_date, summary', 'safe'),
            // The following rule is used by search().
            // Please remove those attributes that should not be searched.
            array('app_id, package_id, app_name, country_id, category_id, app_specify_flag, artist_url, artist_name, price, current_version, version_update_date, require_android, size, insert_date, update_date, delete_date, delete_flag, display_flag, summary, app_icon, screenshot1, screenshot2, screenshot3, screenshot4, screenshot5, screenshot6, screenshot7, screenshot8', 'safe', 'on' => 'search'),
        );
    }

    /**
     * @return array relational rules.
     */
    public function relations() {
        // NOTE: you may need to adjust the relation name and the related
        // class name for the relations automatically generated below.
        return array(
            'keywordCodes' => array(self::MANY_MANY, 'KeywordCode', 'keyword_app(app_id, keyword_id)'),
            'apps' => array(self::HAS_MANY, 'App', 'app_id'),
            'countryCode' => array(self::HAS_ONE, 'CountryCode', 'country_id'),
            'categoryCode' => array(self::HAS_ONE, 'CategoryCode', 'category_id'),
            'keywordApps' => array(self::HAS_MANY, 'KeywordApp', 'app_id'),
        );
    }

    /**
     * @return array customized attribute labels (name=>label)
     */
    public function attributeLabels() {
        return array(
            'app_id' => 'App',
            'package_id' => 'Package',
            'app_name' => 'App Name',
            'country_id' => 'Country',
            'category_id' => 'Category',
            'app_specify_flag' => 'App Specify Flag',
            'artist_url' => 'Artist Url',
            'artist_name' => 'Artist Name',
            'price' => 'Price',
            'current_version' => 'Current Version',
            'version_update_date' => 'Version Update Date',
            'require_android' => 'Require Android',
            'size' => 'Size',
            'insert_date' => 'Insert Date',
            'update_date' => 'Update Date',
            'delete_date' => 'Delete Date',
            'delete_flag' => 'Delete Flag',
            'display_flag' => 'Display Flag',
            'summary' => 'Summary',
            'app_icon' => 'App Icon',
            'rating' => 'Rating',
            'rating_count' => 'Rating Count',
            'screenshot1' => 'Screenshot1',
            'screenshot2' => 'Screenshot2',
            'screenshot3' => 'Screenshot3',
            'screenshot4' => 'Screenshot4',
            'screenshot5' => 'Screenshot5',
            'screenshot6' => 'Screenshot6',
            'screenshot7' => 'Screenshot7',
            'screenshot8' => 'Screenshot8',
        );
    }

    /**
     * Retrieves a list of models based on the current search/filter conditions.
     * @return CActiveDataProvider the data provider that can return the models based on the search/filter conditions.
     */
    public function search() {
        // Warning: Please modify the following code to remove attributes that
        // should not be searched.

        $criteria = new CDbCriteria;

        $criteria->compare('app_id', $this->app_id, true);
        $criteria->compare('package_id', $this->package_id, true);
        $criteria->compare('app_name', $this->app_name, true);
        $criteria->compare('country_id', $this->country_id);
        $criteria->compare('category_id', $this->category_id, true);
        $criteria->compare('app_specify_flag', $this->app_specify_flag);
        $criteria->compare('artist_url', $this->artist_url, true);
        $criteria->compare('artist_name', $this->artist_name, true);
        $criteria->compare('price', $this->price, true);
        $criteria->compare('current_version', $this->current_version, true);
        $criteria->compare('version_update_date', $this->version_update_date, true);
        $criteria->compare('require_android', $this->require_android, true);
        $criteria->compare('size', $this->size, true);
        $criteria->compare('insert_date', $this->insert_date, true);
        $criteria->compare('update_date', $this->update_date, true);
        $criteria->compare('delete_date', $this->delete_date, true);
        $criteria->compare('delete_flag', $this->delete_flag);
        $criteria->compare('display_flag', $this->display_flag);
        $criteria->compare('summary', $this->summary, true);
        $criteria->compare('app_icon', $this->app_icon, true);
        $criteria->compare('rating', $this->rating, true);
        $criteria->compare('rating_count', $this->rating_count, true);
        $criteria->compare('screenshot1', $this->screenshot1, true);
        $criteria->compare('screenshot2', $this->screenshot2, true);
        $criteria->compare('screenshot3', $this->screenshot3, true);
        $criteria->compare('screenshot4', $this->screenshot4, true);
        $criteria->compare('screenshot5', $this->screenshot5, true);
        $criteria->compare('screenshot6', $this->screenshot6, true);
        $criteria->compare('screenshot7', $this->screenshot7, true);
        $criteria->compare('screenshot8', $this->screenshot8, true);

        return new CActiveDataProvider($this, array(
                    'criteria' => $criteria,
                ));
    }

    /* @var $keywordCode KeywordCode */

    public function addKeywordCode($keywordCode) {

        $appCodes = $keywordCode->appCodes;
        array_push($appCodes, $this);
        $keywordCode->appCodes = $appCodes;
        return $keywordCode->save();
    }

    public function addRelation($keywordCode) {
        $keywordApp = new KeywordApp();
        $keywordApp->app_id = $this->app_id;
        $keywordApp->keyword_id = $keywordCode->keyword_id;
        return $keywordApp->save();
    }

    public function behaviors() {
        return array(
            'activerecord-relation' => array(
                'class' => 'ext.yiiext.behaviors.activerecord-relation.EActiveRecordRelationBehavior',
            ),
        );
    }

    protected function beforeValidate() {
        if ($this->isNewRecord) {
            $this->insert_date = time();
        }
        $this->update_date = time;
        return true;
    }

}